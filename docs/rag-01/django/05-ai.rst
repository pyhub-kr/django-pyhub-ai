OpenAI LLMì„ í™œìš©í•˜ì—¬ AI ì‘ë‹µ ìƒì„±
=====================================


.. admonition:: `ê´€ë ¨ ì»¤ë°‹ <https://github.com/pyhub-kr/django-llm-chat-proj/commit/91eb633465e829892b8b85a29a40c8d1880f7753>`_
   :class: dropdown

   * ë³€ê²½ íŒŒì¼ì„ í•œ ë²ˆì— ë®ì–´ì“°ê¸° í•˜ì‹¤ë ¤ë©´, :doc:`/utils/pyhub-git-commit-apply` ì„¤ì¹˜í•˜ì‹  í›„ì—, í˜„ì¬ í”„ë¡œì íŠ¸ ë£¨íŠ¸ ê²½ë¡œì—ì„œ ëª…ë ¹ì–´ ì‹¤í–‰

   .. code-block:: bash

      uv run pyhub-git-commit-apply https://github.com/pyhub-kr/django-llm-chat-proj/commit/91eb633465e829892b8b85a29a40c8d1880f7753


.. raw:: html

    8ë¶„ 37ì´ˆë¶€í„° 32ë¶„ 40ì´ˆê¹Œì§€ ë³´ì‹œë©´ ë©ë‹ˆë‹¤.

    <div class="video-container">
        <iframe
            src="https://www.youtube.com/embed/Lzy9F_Hv4z8?si=jGIgze35S5n27ztg&start=517"
            frameborder="0"
            allowfullscreen>
        </iframe>
    </div>

----

ë³¸ ë¼ì´ë¸Œ #3 ë¶€í„° ì‹¤ìŠµì„ ì‹œì‘í•˜ì‹ ë‹¤ë©´?
-----------------------------------------

ë¨¼ì € ì§ì „ ì‹¤ìŠµê¹Œì§€ì˜ `í”„ë¡œì íŠ¸ ì½”ë“œë¥¼ ë‹¤ìš´ë¡œë“œ <https://github.com/pyhub-kr/django-llm-chat-proj/archive/c21bacf0e48a310877b89da2b3bcf27a03cd5683.zip>`_\í•´ì£¼ì„¸ìš”.

``manage.py`` íŒŒì¼ì´ ìˆëŠ” í”„ë¡œì íŠ¸ ë£¨íŠ¸ ê²½ë¡œì—ì„œ ``.env`` íŒŒì¼ì„ ìƒì„±í•˜ê³ , ì•„ë˜ì™€ ê°™ì´ ``OPENAI_API_KEY`` í™˜ê²½ ë³€ìˆ˜ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.

.. code-block:: text
    :caption: ``.env`` íŒŒì¼ì— ``OPENAI_API_KEY`` í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

    OPENAI_API_KEY=sk-...

í¸í•˜ì‹  ë°©ë²•ìœ¼ë¡œ ê°€ìƒí™˜ê²½ì„ ìƒì„±í•´ì£¼ì‹œê³ , ``requirements.txt`` íŒŒì¼ì— ëª…ì‹œëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì„¤ì¹˜í•´ì£¼ì„¸ìš”.

.. code-block:: shell

    # uv ìœ í‹¸ë¦¬í‹° ì„¤ì¹˜
    python -m pip install --upgrade uv

    # uvë¥¼ í™œìš©í•œ ê°€ìƒí™˜ê²½ ìƒì„± ë° ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
    uv venv
    uv pip install -r requirements.txt

ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì§„í–‰í•˜ê³ , ê´€ë¦¬ì ê³„ì •ì„ ìƒì„±í•˜ì‹œê³ , ê°œë°œì„œë²„ë¥¼ êµ¬ë™í•´ì£¼ì„¸ìš”.

.. code-block:: text

    uv run python manage.py migrate
    uv run python manage.py createsuperuser
    uv run python manage.py runserver 0.0.0.0:8000

ë¸Œë¼ìš°ì €ë¡œ http://localhost:8000 ì— ì ‘ì†í•˜ì‹œë©´, http://localhost:8000/chat/ í˜ì´ì§€ë¡œ ìë™ ì´ë™í•©ë‹ˆë‹¤.
ì±„íŒ…ì°½ì— hello ë¼ê³  ì…ë ¥í•˜ì‹œë©´ "ì…ë ¥í•˜ì‹  ë©”ì‹œì§€ëŠ” 5ê¸€ìì…ë‹ˆë‹¤." ë¼ëŠ” ì‘ë‹µì„ ë°›ìœ¼ì‹œê²Œ ë©ë‹ˆë‹¤.

ì´ì œ ì‹¤ìŠµ ì¤€ë¹„ ëì…ë‹ˆë‹¤.

VSCode, PyCharm Professional ë“± í¸í•˜ì‹  ì—ë””í„°ë¡œ í”„ë¡œì íŠ¸ ë£¨íŠ¸ ê²½ë¡œë¥¼ ì—´ì–´ì£¼ì„¸ìš”.

ì´ì œ ì‹œì‘í•´ë³´ì‹¤ê¹Œìš”? ğŸ˜‰

ë¯¸ë¦¬ë³´ê¸°
--------

"ì…ë ¥í•˜ì‹  ê¸€ìëŠ” 10 ê¸€ìì…ë‹ˆë‹¤." ì‘ë‹µì€ ë„ˆë¬´ ë¶€ì‹¤í•˜ì£ .
ì´ì œ OpenAI LLMì„ í†µí•´ ì‘ë‹µì„ ìƒì„±í•´ë´…ì‹œë‹¤. ì„œë²„ ì‘ë‹µ ë£¨í‹´ë§Œ ë³€ê²½í•´ì£¼ë©´ ë©ë‹ˆë‹¤.
ëŒ€í™” ë‚´ì—­ì€ ê´€ë¦¬í•˜ì§€ ì•Šê¸°ì— ë§¥ë½ì€ ìœ ì§€ë˜ì§€ ì•Šêµ¬ìš”.
ë§¤ë²ˆ ëŒ€í™” ë©”ì‹œì§€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‘ë‹µì„ ìƒì„±í•©ë‹ˆë‹¤.

.. figure:: ./assets/05-ai.gif
   :alt: 05-ai.gif

   ì…ë ¥ ë©”ì‹œì§€ë¥¼ OpenAI LLMì—ê²Œ ì „ë‹¬í•˜ê³ , ê·¸ ì‘ë‹µì„ í™”ë©´ì— ì¶”ê°€í•©ë‹ˆë‹¤.


OpenAI LLM í˜¸ì¶œ
----------------

OpenAI API í˜¸ì¶œì„ ìœ„í•´ ``openai`` íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.

.. code-block:: text
   :caption: requirements.txt ì— ì¶”ê°€

   openai

.. code-block:: bash
   :caption: ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜

   # pipë¥¼ ì‚¬ìš©í•  ê²½ìš°
   python -m pip install openai

   # uvë¥¼ ì‚¬ìš©í•  ê²½ìš°
   uv pip install openai


``chat/ai.py`` íŒŒì¼ì„ ìƒì„±í•˜ê³ , ì•„ë˜ì™€ ê°™ì´ ``make_ai_message`` í•¨ìˆ˜ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.
ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ì™€ ìœ ì € ë©”ì‹œì§€ë¥¼ ì¸ìë¡œ ë°›ì•„ OpenAI Chat Completion APIë¥¼ í˜¸ì¶œí•˜ê³  ê·¸ ì‘ë‹µì„ ë°˜í™˜í•©ë‹ˆë‹¤.
ëª¨ë¸ì€ ë¹„ìš©ì´ ì €ë ´í•œ ``gpt-4o-mini`` ë¡œ ê³ ì •í–ˆìŠµë‹ˆë‹¤.

``openai.OpenAi()`` ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì‹œì— ``api_key`` ì¸ìë¡œ ì‚¬ìš©í•  API Keyë¥¼ ì§€ì •í•  ìˆ˜ ìˆëŠ” ë°ìš”.
ì§€ì •í•˜ì§€ ì•Šì•˜ìœ¼ë‹ˆ, :doc:`../setup` í˜ì´ì§€ì—ì„œ ì„¤ì •í–ˆë˜ ``OPENAI_API_KEY`` í™˜ê²½ ë³€ìˆ˜ê°€ ë””í´íŠ¸ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.

.. code-block:: python
   :caption: chat/ai.py ìƒì„±
   :linenos:

   from openai import OpenAI

   def make_ai_message(system_prompt: str, human_message: str) -> str:
       client = OpenAI()

       completion = client.chat.completions.create(
           model="gpt-4o-mini",
           messages=[
               {"role": "system", "content": system_prompt},
               {"role": "user", "content": human_message},
           ],
       )
       ai_message = completion.choices[0].message.content
       return ai_message


``chat/views.py`` ì—ì„œëŠ” ``make_ai_message`` í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ ìƒì„±ëœ ì‘ë‹µì„ ``ai_message`` ë³€ìˆ˜ì— í• ë‹¹í•©ë‹ˆë‹¤.

.. code-block:: python
   :caption: chat/views.py ìˆ˜ì •
   :linenos:

   from chat.ai import make_ai_message

   def reply(request):
       # ...

       # BEFORE
       # ai_message = f"ì…ë ¥í•˜ì‹  ë©”ì‹œì§€ëŠ” {len(human_message)} ê¸€ìì…ë‹ˆë‹¤."

       # AFTER
       system_prompt = "ë‹¹ì‹ ì€ ì¹œì ˆí•œ AI ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤."
       try:
           ai_message = make_ai_message(system_prompt, human_message)
       except Exception as e:
           ai_message = f"ì£„ì†¡í•©ë‹ˆë‹¤. ì‘ë‹µì„ ìƒì„±í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ({e})"

ë§Œì•½ ì•„ë˜ì™€ ê°™ì€ ì—ëŸ¬ ë©”ì‹œì§€ê°€ ë°œìƒí•˜ë©´, :doc:`../setup` í˜ì´ì§€ì˜ ``OPENAI_API_KEY`` í™˜ê²½ ë³€ìˆ˜ ë¶€ë¶„ì„ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.

.. error::

   ì£„ì†¡í•©ë‹ˆë‹¤. ì‘ë‹µì„ ìƒì„±í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. (The api_key client option must be set either by passing api_key to the client or by setting the OPENAI_API_KEY environment variable)

í™˜ê²½ë³€ìˆ˜ ê°œë…ì´ ìµìˆ™í•˜ì§€ ì•Šìœ¼ì‹œë‹¤ë©´, í…ŒìŠ¤íŠ¸ ì„±ê²©ìœ¼ë¡œ ``client = OpenAI()`` ì½”ë“œì— ``api_key`` ì¸ìë¡œ ì‚¬ìš©í•  API Keyë¥¼ í•˜ë“œì½”ë”©í•´ì„œ ë™ì‘ì„ í™•ì¸í•´ë³´ì„¸ìš”. ``api_key`` ì¸ì ì§€ì • í›„ì— ì˜ ë™ì‘í•˜ì‹ ë‹¤ë©´ API KeyëŠ” ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤. í™˜ê²½ë³€ìˆ˜ ì´ë¦„ì„ ì˜ëª» ì§€ì •í–ˆê±°ë‚˜ ê´€ë ¨ ì„¤ì •ì—ì„œ ì˜¤ë¥˜ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. :doc:`../setup` í˜ì´ì§€ ë‚´ìš©ì„ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”. í•˜ì§€ë§Œ ì´ ë°©ë²•ì€ API Key ë…¸ì¶œ ìœ„í—˜ì´ ìˆìŠµë‹ˆë‹¤. ë™ì‘ì„ í…ŒìŠ¤íŠ¸í•˜ì‹  í›„ì— ë°˜ë“œì‹œ ë‹¤ì‹œ í•˜ë“œì½”ë”©í•œ API Keyë¥¼ ì‚­ì œí•´ì£¼ì…”ì•¼ë§Œ í•©ë‹ˆë‹¤.
